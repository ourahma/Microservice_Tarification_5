spring.application.name=tarification_itn

# ===============================
# CONFIGURATION SERVEUR
# ===============================
server.port=8081

server.servlet.context-path=/

springdoc.api-docs.servers[0].url=http://172.30.80.11:31022/
springdoc.api-docs.servers[0].description=Production Server
springdoc.api-docs.servers[1].url=http://localhost:8081
springdoc.api-docs.servers[1].description=Local Server

# SpringDoc OpenAPI configuration
springdoc.api-docs.path=/api-docs
springdoc.swagger-ui.path=/swagger-ui.html
springdoc.swagger-ui.enabled=true
springdoc.api-docs.enabled=true
# ===============================
# BASE DE DONNEES MYSQL
# ===============================
spring.datasource.url=jdbc:mysql://localhost:3306/tarification_db?useSSL=false&serverTimezone=UTC&allowPublicKeyRetrieval=true
spring.datasource.username=root
spring.datasource.password=
spring.datasource.driver-class-name=com.mysql.cj.jdbc.Driver

# Configuration Hibernate/JPA
spring.jpa.hibernate.ddl-auto=update
spring.jpa.database-platform=org.hibernate.dialect.MySQL8Dialect
spring.jpa.properties.hibernate.dialect=org.hibernate.dialect.MySQL8Dialect
spring.jpa.show-sql=true
spring.jpa.properties.hibernate.format_sql=true
spring.jpa.properties.hibernate.jdbc.batch_size=20
spring.jpa.properties.hibernate.order_inserts=true
spring.jpa.properties.hibernate.order_updates=true

# ===============================
# CONFIGURATION DES MICROSERVICES
# ===============================
# Microservice Demande
spring.microservices.demande.base-url=${DEMANDE_SERVICE_URL:http://172.30.80.11:31029/api/v1/demandes}
spring.microservices.demande.timeout=5000
spring.microservices.demande.max-retries=3

# Microservice Itinéraire
spring.microservices.itineraire.base-url=${ITINERAIRE_SERVICE_URL:http://172.30.80.11:31030/api/routes/}
spring.microservices.itineraire.timeout=5000
spring.microservices.itineraire.max-retries=3

# Microservice Authentification
jwt.secret=transport_marchandises_api2025vs2026
spring.microservices.auth.base-url=${AUTH_SERVICE_URL:http://localhost:8080/api/auth}
spring.microservices.auth.validate-token=${spring.microservices.auth.base-url}/validate
spring.microservices.auth.secret-key=${JWT_SECRET:votre-secret-jwt-tres-securise-ici-pour-validation-des-tokens}

# ===============================
# TARIFICATION - PARAMETRES PAR DEFAUT
# ===============================
# Prix de base
tarification.prix.base=500.0
# Prix par kilomètre
tarification.prix.par-km=10.0
# Prix par kilogramme
tarification.prix.par-kg=5.0
# Prix par mètre cube
tarification.prix.par-m3=15.0
# Multiplicateur pour marchandise fragile
tarification.prix.fragile-multiplier=1.3
# Multiplicateur pour contrôle de température
tarification.prix.temperature-control-multiplier=1.5
# Multiplicateur pour route nationale
tarification.prix.route-nationale-multiplier=1.5
# Marge pour le prestataire (25%)
tarification.prix.marge-prestataire=0.25

# ===============================
# ACTUATOR CONFIGURATION
# ===============================
management.endpoints.web.exposure.include=health,info,metrics,loggers,prometheus,env,beans
management.endpoint.health.show-details=always
management.endpoint.health.show-components=always
management.info.env.enabled=true
management.info.java.enabled=true
management.info.os.enabled=true
management.endpoints.web.base-path=/actuator
management.metrics.enable.http=true

# Optionnel : logging pour Actuator
logging.level.org.springframework.boot.actuate=INFO
# ===============================
# LOGGING
# ===============================
logging.level.root=INFO
logging.level.com.example.tarification=DEBUG
logging.level.org.springframework.web=INFO
logging.level.org.hibernate=ERROR
logging.pattern.console=%d{yyyy-MM-dd HH:mm:ss} [%thread] %-5level %logger{36} - %msg%n
logging.file.name=logs/tarification-service.log
logging.file.max-size=10MB
logging.file.max-history=30

# ===============================
# WEB CLIENT CONFIGURATION
# ===============================
spring.webflux.client.max-in-memory-size=16MB

# ===============================
# SPRING SECURITY
# ===============================

# ===============================
# CORS CONFIGURATION
# ===============================
# spring.web.cors.allowed-origins=http://localhost:3000,http://localhost:8080,http://localhost:8081,http://localhost:8082
# spring.web.cors.allowed-methods=GET,POST,PUT,DELETE,OPTIONS
# spring.web.cors.allowed-headers=*
# spring.web.cors.allow-credentials=true


# ===============================
# PERFORMANCE & OPTIMIZATION
# ===============================
spring.servlet.multipart.max-file-size=10MB
spring.servlet.multipart.max-request-size=10MB
spring.mvc.log-request-details=true

# ===============================
# RESILIENCE (CIRCUIT BREAKER PATTERN)
# ===============================
# resilience4j.circuitbreaker.instances.demande-service.failure-rate-threshold=50
# resilience4j.circuitbreaker.instances.demande-service.wait-duration-in-open-state=10000
# resilience4j.circuitbreaker.instances.demande-service.sliding-window-size=10
# resilience4j.circuitbreaker.instances.itineraire-service.failure-rate-threshold=50
# resilience4j.circuitbreaker.instances.itineraire-service.wait-duration-in-open-state=10000
# resilience4j.circuitbreaker.instances.itineraire-service.sliding-window-size=10

# ===============================
# SCHEDULING (TÂCHES PLANIFIÉES)
# ===============================
# Pour nettoyer les tarifications expirées
spring.task.scheduling.pool.size=5
tarification.cleanup.cron=0 0 2 * * ? # Tous les jours à 2h du matin
tarification.expiration.days=7
